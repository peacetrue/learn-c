= 参考指南

== 源码结构

* .github：Github Action 目录
* builder：构建目录，含各种 C 程序构建方式
* case：案例目录，使用 Makefile 构建各种案例
* docs：文档目录
* elf：elf 目录，分析 elf 的构建过程
* gradle：Gradle wrapper 目录
* src：源码目录
** lib：类库目录，构建类库
** main：主目录，构建可执行文件
** test：测试目录，使用 gtest 测试
* .gitignore：配置忽略的文件
* build.gradle：Gradle 构建文件
* CMakeLists.txt：CMake 构建文件
* gradlew：Gradle Linux 命令
* gradlew.bat：Gradle Window 命令
* LICENSE：许可证
* README.adoc：自述文件
* settings.gradle：Gradle 配置文件

== 参考

. https://en.cppreference.com/[C++ 官网^]
. https://itanium-cxx-abi.github.io/cxx-abi/abi.html[Itanium C++ ABI^（GCC）]
. https://www.gnu.org/[GNU^]
. https://sourceware.org/[Free the Software^]

== 术语

== 文件类型

开发过程中，会涉及各种类型的文件。

C 源文件(c source code file)::
包含具体实现代码。
预处理操作包括：引入所有头文件、替换宏、删除注释等等。
* 非预处理源文件：以 .c 后缀结尾。
* 预处理后源文件：以 .i 后缀结尾。
头文件(head file)::
以 .h 后缀结尾，包含接口声明代码。
汇编源文件(assembly source code file)::
C 源文件编译后形成的汇编文件。
* 非预处理源文件：以 .S(sx/asm) 后缀结尾，代表仍必须通过预处理器的汇编代码。这意味着它可以具有 #include 和 #define 其他宏。
* 预处理后源文件：以 .s 后缀结尾，纯汇编代码，可以编译成一个对象。
对象文件(object file)::
以 .o 后缀结尾，源文件编译后形成对象文件。
静态库文件::
以 .a 后缀结尾，一组对象文件的压缩包。
共享库文件::
以 .so 后缀结尾，ELF 格式文件即 linux 可执行文件，可用于多个进程的共享。
程序在使用它时，会在运行时把它映射到自己进程空间的某一处，其不在使用它的程序中。
二进制文件(bitcode file)::
以 .bc 后缀结尾，对象文件编译后形成二进制文件。
可执行文件::
二进制文件链接后形成可执行文件。

== 编译流程

[source%nowrap,bash,subs="specialchars,attributes"]
----
cd $workingDir/learn-c
# 编译源文件，生成可执行文件，保留中间生成的临时文件
gcc --save-temps -o main main.c
# main.c -> main.i -> main.s -> main.o -> main.bc -> main

gcc -E -o main.i main.c
gcc -S -o main.s main.i
gcc -c -o main.o main.s
# 选项 r 表示添加文件，选项 c 表示新建库文件，选项 s 表示创建符号表
ar rcs main.a main.o
gcc -o main main.o
----

== 调试

[source%nowrap,bash,subs="specialchars,attributes"]
----
# 编译出一个调试版本的可执行文件
gcc -g -o main main.c
gdb main
# list break info next print
----

== 构建项目

. 手动
. Make：Makefile
. CMake：CMakeList.txt
. Gradle：cpp-library

== 单元测试

如何在 CLion 中执行 C 单元测试？
参考 https://www.jetbrains.com/zh-cn/clion/features/unit-testing.html[CLion 单元测试^]。

https://github.com/google/googletest[Google Test^]

== 附录

* https://stackoverflow.com/questions/10285410/what-are-s-files[What are .S files?^]
* https://blog.csdn.net/gjq_1988/article/details/39520729[CPU 乱序执行原理^]
* https://zhuanlan.zhihu.com/p/422848235[内存一致性(Memory Consistency)^]
* https://zhuanlan.zhihu.com/p/41872203[X86/GCC memory fence的一些见解^]
* https://www.jianshu.com/p/6ab7c3db13c3[通过 JVM (HotSpot) 源码和汇编理解 Java volatile 实现原理^]

